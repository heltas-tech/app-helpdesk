<div class="notificaciones-container">
  <!-- Botón de la campanita -->
  <button class="campanita-btn" 
          (click)="toggleLista()" 
          aria-label="Notificaciones"
          mat-icon-button
          matTooltip="Notificaciones">
    <mat-icon class="campanita-icon">notifications</mat-icon>
    
    <!-- Contador de notificaciones no leídas -->
    <div class="contador-notificaciones" *ngIf="notificacionesNoLeidas > 0">
      {{ notificacionesNoLeidas > 99 ? '99+' : notificacionesNoLeidas }}
    </div>

    <!-- Indicador de conexión WebSocket -->
    <div class="conexion-indicator" 
         [class.conectado]="websocketConectado"
         [matTooltip]="websocketConectado ? 'WebSocket Conectado' : 'WebSocket Desconectado'">
    </div>
  </button>

  <!-- Lista de notificaciones -->
  <div class="lista-notificaciones" *ngIf="mostrarLista">
    <div class="header-lista">
      <div class="titulo-seccion">
        <mat-icon class="titulo-icono">notifications</mat-icon>
        <h3>Notificaciones</h3>
        <span class="contador-total">({{notificaciones.length}})</span>
      </div>
      
      <div class="botones-accion">
        <button class="btn-accion btn-diagnostico" 
                (click)="probarDiagnostico()" 
                mat-icon-button
                matTooltip="Diagnóstico">
          <mat-icon>analytics</mat-icon>
        </button>
        
        <button class="btn-accion btn-marcar-todas" 
                (click)="marcarTodasComoLeidas()" 
                *ngIf="notificacionesNoLeidas > 0"
                mat-icon-button
                matTooltip="Marcar todas como leídas">
          <mat-icon>mark_email_read</mat-icon>
        </button>
      </div>
    </div>

    <!-- Contenido -->
    <div class="contenido-lista">
      <!-- Estado de carga -->
      <div class="estado-cargando" *ngIf="cargando">
        <mat-progress-spinner diameter="40" mode="indeterminate"></mat-progress-spinner>
        <p>Cargando notificaciones...</p>
      </div>

      <!-- Sin notificaciones -->
      <div class="estado-vacio" *ngIf="!cargando && notificaciones.length === 0">
        <mat-icon class="icono-vacio">notifications_off</mat-icon>
        <h4>No hay notificaciones</h4>
        <p>Las nuevas notificaciones aparecerán aquí</p>
      </div>

      <!-- Lista de notificaciones -->
      <div class="lista-items" *ngIf="!cargando && notificaciones.length > 0">
        <div class="notificacion-item" 
             *ngFor="let notificacion of notificaciones" 
             [class.no-leida]="!notificacion.leida"
             [class.leida]="notificacion.leida">
          
          <div class="notificacion-icono" [class]="getColorIconoTipo(notificacion.tipo)">
            <mat-icon>{{ getIconoTipo(notificacion.tipo) }}</mat-icon>
          </div>

          <div class="notificacion-contenido">
            <div class="notificacion-header">
              <h4 class="notificacion-titulo">{{ notificacion.titulo }}</h4>
              <span class="notificacion-fecha">{{ formatearFecha(notificacion.fecha_creacion) }}</span>
            </div>
            
            <p class="notificacion-mensaje">{{ notificacion.mensaje }}</p>
            
            <div class="notificacion-tipo">
              <span class="tipo-badge">{{ notificacion.tipo }}</span>
            </div>

            <div class="notificacion-acciones">
              <!-- Botón Ver Ticket -->
              <button class="btn-accion btn-ver" 
                      (click)="verTicket(notificacion, $event)"
                      *ngIf="esNotificacionTicket(notificacion)"
                      mat-raised-button
                      color="primary">
                <mat-icon>visibility</mat-icon>
                Ver Ticket
              </button>
              
              <!-- Botón Marcar como Leída -->
              <button class="btn-accion btn-marcar-leida" 
                      (click)="marcarComoLeida(notificacion, $event)"
                      *ngIf="!notificacion.leida"
                      mat-button
                      color="accent">
                <mat-icon>mark_email_read</mat-icon>
                Leída
              </button>
              
              <!-- Botón Eliminar -->
              <button class="btn-accion btn-eliminar" 
                      (click)="eliminarNotificacion(notificacion, $event)"
                      mat-button
                      color="warn">
                <mat-icon>delete</mat-icon>
                Eliminar
              </button>
            </div>
          </div>

          <!-- Indicador de no leída -->
          <div class="indicador-no-leida" *ngIf="!notificacion.leida"></div>
        </div>
      </div>
    </div>
  </div>
</div>