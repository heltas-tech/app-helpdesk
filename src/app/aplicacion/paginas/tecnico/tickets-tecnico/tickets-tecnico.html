<div class="min-h-screen bg-gray-50 p-4 md:p-6">
  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-900">Mis Tickets Asignados</h1>
    <p class="text-gray-600 mt-1">Gestiona y da seguimiento a los tickets asignados a ti</p>
  </div>

  <!-- Barra de Búsqueda -->
  <div class="bg-white rounded-lg border border-gray-200 p-4 mb-6">
    <div class="flex flex-col md:flex-row gap-4 items-center">
      <div class="flex-1 relative w-full">
        <input
          type="text"
          [(ngModel)]="textoBusqueda"
          (input)="aplicarBusqueda()"
          placeholder="Buscar en tickets..."
          class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-gray-400 transition-colors">
      </div>
      <button
        (click)="limpiarBusqueda()"
        class="px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
        Limpiar
      </button>
    </div>
  </div>

  <!-- Tabla -->
  <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
    <div class="overflow-x-auto">
      <table mat-table [dataSource]="dataSource" class="w-full">
        
        <!-- ID -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-sm font-medium text-gray-900 bg-gray-50">
            ID
          </th>
          <td mat-cell *matCellDef="let ticket" class="px-4 py-3 text-sm text-gray-900 font-medium">
            <div class="flex items-center gap-2">
              <span>#{{ticket.id}}</span>
              <span *ngIf="esReabierto(ticket)" 
                    class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-50 text-purple-700 border border-purple-200">
                {{ticket.veces_reabierto || 1}}x
              </span>
            </div>
          </td>
        </ng-container>

        <!-- ASUNTO -->
        <ng-container matColumnDef="asunto">
          <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-sm font-medium text-gray-900 bg-gray-50">
            Asunto
          </th>
          <td mat-cell *matCellDef="let ticket" class="px-4 py-3">
            <div class="max-w-xs">
              <div class="flex items-center gap-2 mb-1">
                <div [class]="'w-2 h-2 rounded-full ' + getColorUrgencia(ticket)"></div>
                <div class="text-sm font-medium text-gray-900 truncate">{{ticket.titulo}}</div>
              </div>
              <div class="text-xs text-gray-500 truncate">
                {{getDescripcionCorta(ticket)}}
              </div>
              <div class="flex gap-1 mt-1.5">
                <span *ngIf="esUrgente(ticket)" 
                      class="inline-flex px-2 py-0.5 rounded text-xs font-medium bg-red-50 text-red-700 border border-red-200">
                  URGENTE
                </span>
                <span *ngIf="esAltaPrioridad(ticket) && !esUrgente(ticket)" 
                      class="inline-flex px-2 py-0.5 rounded text-xs font-medium bg-orange-50 text-orange-700 border border-orange-200">
                  ALTA
                </span>
              </div>
            </div>
          </td>
        </ng-container>

        <!-- CLIENTE -->
        <ng-container matColumnDef="cliente">
          <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-sm font-medium text-gray-900 bg-gray-50">
            Cliente
          </th>
          <td mat-cell *matCellDef="let ticket" class="px-4 py-3 text-sm text-gray-900">
            <div class="flex items-center">
              <div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center mr-2 text-xs text-gray-600">
                {{getInicialCliente(ticket)}}
              </div>
              <div class="min-w-0">
                <div class="font-medium text-gray-900 truncate">{{getNombreCliente(ticket)}}</div>
                <div class="text-xs text-gray-500 truncate">{{getEntidadCliente(ticket)}}</div>
              </div>
            </div>
          </td>
        </ng-container>

        <!-- ESTADO -->
        <ng-container matColumnDef="estado">
          <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-sm font-medium text-gray-900 bg-gray-50">
            Estado
          </th>
          <td mat-cell *matCellDef="let ticket" class="px-4 py-3">
            <div class="flex flex-col gap-1.5">
              <span class="inline-flex px-3 py-1 rounded-full text-xs font-medium border"
                    [ngClass]="getEstadoClase(ticket)">
                {{getEstadoTexto(ticket)}}
              </span>
             
            </div>
          </td>
        </ng-container>

        <!-- PRIORIDAD -->
        <ng-container matColumnDef="prioridad">
          <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-sm font-medium text-gray-900 bg-gray-50">
            Prioridad
          </th>
          <td mat-cell *matCellDef="let ticket" class="px-4 py-3">
            <div *ngIf="ticket.prioridad">
              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border"
                    [ngClass]="getPrioridadClase(ticket)">
                <span class="w-2 h-2 rounded-full mr-1.5" [ngClass]="getPrioridadPuntoClase(ticket)"></span>
                {{getPrioridadTexto(ticket.prioridad.nivel)}}
              </span>
            </div>
            <div *ngIf="!ticket.prioridad" class="text-gray-400 italic text-xs">
              Sin asignar
            </div>
          </td>
        </ng-container>

        <!-- CATEGORÍA -->
        <ng-container matColumnDef="categoria">
          <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-sm font-medium text-gray-900 bg-gray-50">
            Categoría
          </th>
          <td mat-cell *matCellDef="let ticket" class="px-4 py-3 text-sm text-gray-900">
            <div class="max-w-xs">
              <div>{{ticket.categoria?.nombre || 'General'}}</div>
              <div *ngIf="ticket.subcategoria?.nombre" class="text-xs text-gray-500 truncate">
                {{ticket.subcategoria.nombre}}
              </div>
            </div>
          </td>
        </ng-container>

        <!-- FECHA CREACIÓN -->
        <ng-container matColumnDef="fecha_creacion">
          <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-sm font-medium text-gray-900 bg-gray-50">
            Creado
          </th>
          <td mat-cell *matCellDef="let ticket" class="px-4 py-3 text-sm text-gray-900">
            <div>
              <div>{{ticket.fecha_creacion | date:'dd/MM/yyyy'}}</div>
              <div class="text-xs text-gray-500">{{ticket.fecha_creacion | date:'HH:mm'}}</div>
            </div>
          </td>
        </ng-container>

        <!-- TIEMPO ESPERA -->
        <ng-container matColumnDef="tiempo_espera">
          <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-sm font-medium text-gray-900 bg-gray-50">
            Tiempo
          </th>
          <td mat-cell *matCellDef="let ticket" class="px-4 py-3 text-sm text-gray-900">
            <div>
              <div>{{getTiempoTranscurrido(ticket.fecha_creacion)}}</div>
              <div *ngIf="esTicketAntiguo(ticket)" class="text-xs text-red-600 mt-1">
                Atención requerida
              </div>
            </div>
          </td>
        </ng-container>

        <!-- ACCIONES -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-sm font-medium text-gray-900 bg-gray-50">
            Acciones
          </th>
          <td mat-cell *matCellDef="let ticket" class="px-4 py-3">
            <div class="flex gap-2">
              <button
                (click)="abrirDetalleTicket(ticket)"
                class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm">
                Gestionar
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-50"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
            class="border-b border-gray-100"></tr>
      </table>
    </div>

    <!-- Sin resultados -->
    <div *ngIf="dataSource.filteredData.length === 0" class="text-center py-12">
      <h3 class="text-lg font-semibold text-gray-900 mb-2">
        {{textoBusqueda ? 'No se encontraron tickets' : 'No tienes tickets asignados'}}
      </h3>
      <p class="text-gray-600 mb-4">
        {{textoBusqueda ? 
          'No hay tickets que coincidan con "' + textoBusqueda + '"' : 
          'Los tickets que te asignen aparecerán aquí'
        }}
      </p>
      <button 
        (click)="limpiarBusqueda()"
        class="px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors"
        *ngIf="textoBusqueda">
        Limpiar búsqueda
      </button>
    </div>

    <!-- Paginación -->
    <mat-paginator
      [pageSize]="10"
      [pageSizeOptions]="[5, 10, 20, 50]"
      showFirstLastButtons
      class="custom-paginator">
    </mat-paginator>
  </div>
</div>