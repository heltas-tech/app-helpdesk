<div class="modal-container">
  <div class="card">
    
    <!-- Título -->
    <a class="login">{{ isEditMode ? 'EDITAR CONTRATO' : 'NUEVO CONTRATO' }}</a>

    <form [formGroup]="form" class="form-content">
      
      <!-- Spinner mientras carga -->
      <div *ngIf="cargando" class="flex justify-center items-center py-8">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"></div>
        <span class="ml-3 text-gray-600">Cargando datos...</span>
      </div>

      <!-- Sección: Información Básica -->
      <div class="section-container">
        <h3 class="section-title">
          <mat-icon>info</mat-icon>
          Información Básica
        </h3>
        
        <div class="row-fields">
          <!-- Título -->
          <div class="inputBox half-width">
            <input 
              type="text" 
              formControlName="titulo"
              required
              [class.has-value]="titulo?.value"
              [class.invalid]="titulo?.invalid && titulo?.touched"
              placeholder=" ">
            <span>Título del Contrato</span>
            @if (titulo?.invalid && titulo?.touched) {
              <div class="error-message">
                {{ getErrorMessage('titulo') }}
              </div>
            }
          </div>

          <!-- Tipo de Contrato -->
          <div class="inputBox half-width">
            <select 
              formControlName="tipo_contrato"
              required
              [class.has-value]="form.get('tipo_contrato')?.value"
              [class.invalid]="form.get('tipo_contrato')?.invalid && form.get('tipo_contrato')?.touched">
              <option value=""></option>
              <option *ngFor="let tipo of tiposContrato" [value]="tipo.value">
                {{ tipo.label }}
              </option>
            </select>
            <span>Tipo de Contrato</span>
            @if (form.get('tipo_contrato')?.invalid && form.get('tipo_contrato')?.touched) {
              <div class="error-message">
                {{ getErrorMessage('tipo_contrato') }}
              </div>
            }
          </div>
        </div>

        <!-- Descripción -->
        <div class="inputBox">
          <textarea 
            formControlName="descripcion"
            [class.has-value]="form.get('descripcion')?.value"
            placeholder=" "
            rows="3"></textarea>
          <span>Descripción</span>
        </div>
      </div>

      <!-- Sección: Entidad y SLA -->
      <div class="section-container">
        <h3 class="section-title">
          <mat-icon>business</mat-icon>
          Entidad y SLA
        </h3>
        
        <div class="row-fields">
          <!-- Entidad -->
          <div class="inputBox half-width">
            <select 
              formControlName="entidad_id"
              required
              [class.has-value]="entidad_id?.value"
              [class.invalid]="entidad_id?.invalid && entidad_id?.touched">
              <option value=""></option>
              <option *ngFor="let entidad of entidades" [value]="entidad.id">
                {{ entidad.denominacion }}
              </option>
            </select>
            <span>Entidad</span>
            @if (entidad_id?.invalid && entidad_id?.touched) {
              <div class="error-message">
                {{ getErrorMessage('entidad_id') }}
              </div>
            }
          </div>

          <!-- SLA -->
          <div class="inputBox half-width">
            <select 
              formControlName="sla_id"
              required
              [class.has-value]="sla_id?.value"
              [class.invalid]="sla_id?.invalid && sla_id?.touched">
              <option value=""></option>
              <option *ngFor="let sla of slas" [value]="sla.id">
                {{ sla.nombre }}
              </option>
            </select>
            <span>SLA</span>
            @if (sla_id?.invalid && sla_id?.touched) {
              <div class="error-message">
                {{ getErrorMessage('sla_id') }}
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Sección: Fechas -->
      <div class="section-container">
        <h3 class="section-title">
          <mat-icon>event</mat-icon>
          Fechas del Contrato
        </h3>
        
        <div class="row-fields">
          <!-- Fecha Inicio -->
          <div class="inputBox half-width">
            <input 
              type="date"
              formControlName="fecha_inicio"
              required
              [class.has-value]="fecha_inicio?.value"
              [class.invalid]="fecha_inicio?.invalid && fecha_inicio?.touched"
              placeholder=" ">
            <span>Fecha Inicio</span>
            @if (fecha_inicio?.invalid && fecha_inicio?.touched) {
              <div class="error-message">
                {{ getErrorMessage('fecha_inicio') }}
              </div>
            }
          </div>

          <!-- Fecha Fin -->
          <div class="inputBox half-width">
            <input 
              type="date"
              formControlName="fecha_fin"
              required
              [class.has-value]="fecha_fin?.value"
              [class.invalid]="fecha_fin?.invalid && fecha_fin?.touched"
              placeholder=" ">
            <span>Fecha Fin</span>
            @if (fecha_fin?.invalid && fecha_fin?.touched) {
              <div class="error-message">
                {{ getErrorMessage('fecha_fin') }}
              </div>
            }
          </div>
        </div>

        <!-- Validación de fechas -->
        @if (!validateDates() && fecha_inicio?.value && fecha_fin?.value) {
          <div class="error-message">
            ❌ La fecha de fin debe ser posterior a la fecha de inicio
          </div>
        }
      </div>

      <!-- Sección: Información Financiera -->
      <div class="section-container">
        <h3 class="section-title">
          <mat-icon>attach_money</mat-icon>
          Información Financiera
        </h3>
        
        <div class="row-fields">
          <!-- Monto Total -->
          <div class="inputBox half-width">
            <input 
              type="number"
              formControlName="monto_total"
              min="0"
              step="0.01"
              (blur)="validarMonto($event)"
              [class.has-value]="monto_total?.value"
              [class.invalid]="monto_total?.invalid && monto_total?.touched"
              placeholder=" ">
            <span>Monto Total</span>
            @if (monto_total?.invalid && monto_total?.touched) {
              <div class="error-message">
                {{ getErrorMessage('monto_total') }}
              </div>
            }
          </div>

          <!-- Moneda -->
          <div class="inputBox half-width">
            <select 
              formControlName="moneda"
              [class.has-value]="form.get('moneda')?.value">
              <option *ngFor="let moneda of monedas" [value]="moneda.value">
                {{ moneda.label }}
              </option>
            </select>
            <span>Moneda</span>
          </div>
        </div>

        <div class="row-fields">
          <!-- Periodo Facturación -->
          <div class="inputBox half-width">
            <select 
              formControlName="periodo_facturacion"
              [class.has-value]="form.get('periodo_facturacion')?.value">
              <option *ngFor="let periodo of periodosFacturacion" [value]="periodo.value">
                {{ periodo.label }}
              </option>
            </select>
            <span>Periodo Facturación</span>
          </div>

          <!-- Forma de Pago -->
          <div class="inputBox half-width">
            <input 
              type="text"
              formControlName="forma_pago"
              [class.has-value]="form.get('forma_pago')?.value"
              placeholder=" ">
            <span>Forma de Pago</span>
          </div>
        </div>

        <!-- Cuenta Bancaria -->
        <div class="inputBox">
          <input 
            type="text"
            formControlName="cuenta_bancaria"
            [class.has-value]="form.get('cuenta_bancaria')?.value"
            placeholder=" ">
          <span>Cuenta Bancaria</span>
        </div>
      </div>

      <!-- Sección: Contactos -->
      <div class="section-container">
        <h3 class="section-title">
          <mat-icon>contacts</mat-icon>
          Información de Contacto
        </h3>
        
        <div class="row-fields">
          <!-- Contacto Entidad -->
          <div class="inputBox half-width">
            <input 
              type="text"
              formControlName="contacto_entidad"
              [class.has-value]="form.get('contacto_entidad')?.value"
              placeholder=" ">
            <span>Contacto Entidad</span>
          </div>

          <!-- Teléfono Contacto -->
          <div class="inputBox half-width">
            <input 
              type="text"
              formControlName="telefono_contacto"
              [class.has-value]="form.get('telefono_contacto')?.value"
              placeholder=" ">
            <span>Teléfono Contacto</span>
          </div>
        </div>

        <div class="row-fields">
          <!-- Email Contacto -->
          <div class="inputBox half-width">
            <input 
              type="email"
              formControlName="email_contacto"
              [class.has-value]="form.get('email_contacto')?.value"
              [class.invalid]="email_contacto?.invalid && email_contacto?.touched"
              placeholder=" ">
            <span>Email Contacto</span>
            @if (email_contacto?.invalid && email_contacto?.touched) {
              <div class="error-message">
                {{ getErrorMessage('email_contacto') }}
              </div>
            }
          </div>

          <!-- Representante Entidad -->
          <div class="inputBox half-width">
            <input 
              type="text"
              formControlName="representante_entidad"
              [class.has-value]="form.get('representante_entidad')?.value"
              placeholder=" ">
            <span>Representante Entidad</span>
          </div>
        </div>

        <!-- Representante Heltas -->
        <div class="inputBox">
          <input 
            type="text"
            formControlName="representante_heltas"
            [class.has-value]="form.get('representante_heltas')?.value"
            placeholder=" ">
          <span>Representante Heltas</span>
        </div>
      </div>

      <!-- Sección: Detalles del Servicio -->
      <div class="section-container">
        <h3 class="section-title">
          <mat-icon>handyman</mat-icon>
          Detalles del Servicio
        </h3>
        
        <!-- Servicios Incluidos -->
        <div class="inputBox">
          <textarea 
            formControlName="servicios_incluidos"
            [class.has-value]="form.get('servicios_incluidos')?.value"
            placeholder=" "
            rows="3"></textarea>
          <span>Servicios Incluidos</span>
        </div>

        <!-- Términos y Condiciones -->
        <div class="inputBox">
          <textarea 
            formControlName="terminos_condiciones"
            [class.has-value]="form.get('terminos_condiciones')?.value"
            placeholder=" "
            rows="3"></textarea>
          <span>Términos y Condiciones</span>
        </div>

        <!-- Exclusiones -->
        <div class="inputBox">
          <textarea 
            formControlName="exclusiones"
            [class.has-value]="form.get('exclusiones')?.value"
            placeholder=" "
            rows="2"></textarea>
          <span>Exclusiones</span>
        </div>

        <!-- Penalidades -->
        <div class="inputBox">
          <textarea 
            formControlName="penalidades"
            [class.has-value]="form.get('penalidades')?.value"
            placeholder=" "
            rows="2"></textarea>
          <span>Penalidades</span>
        </div>
      </div>

      <!-- Sección: Configuraciones Adicionales -->
      
    </form>

    <!-- Botones -->
    <div class="button-container">
      <button 
        (click)="cancel()"
        class="cancel-btn">
        Cancelar
      </button>
      
      <button 
        (click)="save()"
        [disabled]="form.invalid || !validateDates()"
        class="enter-btn"
        [class.disabled]="form.invalid || !validateDates()">
        {{ isEditMode ? 'ACTUALIZAR' : 'CREAR' }}
      </button>
    </div>

  </div>
</div>