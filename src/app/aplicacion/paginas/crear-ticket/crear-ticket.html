<div class="p-4 bg-gray-50 min-h-screen">
  <div class="max-w-4xl mx-auto">
    
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold text-gray-800">Crear Nuevo Ticket</h1>
      <div class="text-sm text-gray-500 bg-white px-3 py-1 rounded-full border">
        Campos obligatorios *
      </div>
    </div>

    <!-- Form Container -->
    <div class="bg-white rounded-xl shadow-lg p-6">
      <form (ngSubmit)="crearTicket()" class="space-y-6">
        
        <!-- Asunto -->
        <div class="inputBox">
          <input 
            type="text" 
            [(ngModel)]="ticketData.titulo"
            name="titulo"
            placeholder=" "
            required
            [class.has-value]="ticketData.titulo"
            [class.invalid]="formSubmitted && !ticketData.titulo">
          <span>Asunto del Ticket *</span>
          @if (formSubmitted && !ticketData.titulo) {
            <div class="error-message">
              El asunto es obligatorio
            </div>
          }
        </div>

        <!-- Categoría y Subcategoría -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="inputBox">
            <select
              [(ngModel)]="ticketData.categoria_id"
              (change)="onCategoriaChange()"
              name="categoria_id"
              placeholder=" "
              required
              [class.has-value]="ticketData.categoria_id"
              [class.invalid]="formSubmitted && !ticketData.categoria_id">
              <option value="" disabled selected>Seleccione categoría</option>
              <option *ngFor="let cat of categorias" [value]="cat.id">
                {{ cat.nombre }}
              </option>
            </select>
            <span>Categoría *</span>
            @if (formSubmitted && !ticketData.categoria_id) {
              <div class="error-message">
                Seleccione una categoría
              </div>
            }
          </div>

          <div class="inputBox" *ngIf="ticketData.categoria_id && getSubcategoriasFiltradas().length > 0">
            <select
              [(ngModel)]="ticketData.subcategoria_id"
              name="subcategoria_id"
              placeholder=" "
              [class.has-value]="ticketData.subcategoria_id">
              <option value="" disabled selected>Seleccione subcategoría</option>
              <option *ngFor="let sub of getSubcategoriasFiltradas()" [value]="sub.id">
                {{ sub.nombre }}
              </option>
            </select>
            <span>Subcategoría</span>
          </div>
        </div>

        <!-- Prioridades -->
        <div class="priority-section">
          <label class="section-label">Prioridad *</label>
          
          <div *ngIf="prioridadesCargando" class="loading-priorities">
            <mat-icon class="spinner">autorenew</mat-icon>
            Cargando prioridades disponibles...
          </div>

          <div class="radio-group" *ngIf="!prioridadesCargando && prioridadesSLA.length > 0">
            <div *ngFor="let prioridad of prioridadesSLA" class="radio-option">
              <input 
                type="radio" 
                [id]="'prioridad' + prioridad.id"
                [(ngModel)]="ticketData.prioridad_id"
                name="prioridad_id"
                [value]="prioridad.id"
                class="radio-input"
                required>
              <label [for]="'prioridad' + prioridad.id" class="radio-label">
                <span class="radio-inner-circle"></span>
                <div class="priority-content">
                  <span class="priority-name">{{ prioridad.nombre }}</span>
                  <span class="priority-times">
                    Respuesta: {{ formatearTiempo(prioridad.tiempo_respuesta) }} | 
                    Resolución: {{ formatearTiempo(prioridad.tiempo_resolucion) }}
                  </span>
                </div>
              </label>
            </div>
          </div>

          @if (formSubmitted && !ticketData.prioridad_id) {
            <div class="error-message">
              Seleccione una prioridad para su ticket
            </div>
          }

          <div *ngIf="!prioridadesCargando && prioridadesSLA.length === 0" class="no-priorities">
            <mat-icon>warning</mat-icon>
            No hay prioridades configuradas para su contrato
          </div>
        </div>

        <!-- Descripción -->
        <div class="inputBox">
          <textarea
            [(ngModel)]="ticketData.descripcion"
            name="descripcion"
            rows="5"
            placeholder=" "
            required
            [class.has-value]="ticketData.descripcion"
            [class.invalid]="formSubmitted && !ticketData.descripcion"></textarea>
          <span>Descripción Detallada *</span>
          @if (formSubmitted && !ticketData.descripcion) {
            <div class="error-message">
              Proporcione una descripción detallada del problema
            </div>
          }
        </div>

        <!-- Archivos -->
        <div class="file-section">
          <label class="section-label">Archivos Adjuntos (Opcional)</label>
          
          <div class="file-upload-form">
            <label for="fileInput" class="file-upload-label">
              <div class="file-upload-design">
                <svg viewBox="0 0 640 512" height="1em">
                  <path
                    d="M144 480C64.5 480 0 415.5 0 336c0-62.8 40.2-116.2 96.2-135.9c-.1-2.7-.2-5.4-.2-8.1c0-88.4 71.6-160 160-160c59.3 0 111 32.2 138.7 80.2C409.9 102 428.3 96 448 96c53 0 96 43 96 96c0 12.2-2.3 23.8-6.4 34.6C596 238.4 640 290.1 640 352c0 70.7-57.3 128-128 128H144zm79-217c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l39-39V392c0 13.3 10.7 24 24 24s24-10.7 24-24V257.9l39 39c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9 0l-80 80z"
                  ></path>
                </svg>
                <p class="upload-text">Haga clic para seleccionar archivos</p>
                <span class="browse-button">Buscar archivos</span>
              </div>
              <input 
                id="fileInput" 
                type="file" 
                (change)="onFileSelected($event)"
                multiple
                class="hidden"/>
            </label>
          </div>

          <!-- Archivos seleccionados -->
          <div *ngIf="archivos.length > 0" class="file-list">
            <div class="file-list-header">
              <span>Archivos seleccionados ({{archivos.length}})</span>
            </div>
            <div *ngFor="let archivo of archivos; let i = index" class="file-item">
              <div class="file-info">
                <mat-icon class="file-icon">description</mat-icon>
                <div class="file-details">
                  <span class="file-name">{{ archivo.name }}</span>
                  <span class="file-size">{{ fileUploadService.formatFileSize(archivo.size) }}</span>
                </div>
              </div>
              <button
                type="button"
                (click)="eliminarArchivo(i)"
                class="file-delete"
                title="Eliminar archivo">
                <mat-icon>close</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <!-- Botones -->
        <div class="button-container">
          <button 
            type="button"
            (click)="cancelar()"
            class="cancel-btn">
            Cancelar
          </button>
          
          <button 
            type="submit"
            (click)="crearTicket()"
            [disabled]="!isFormValid() || enviando"
            class="submit-btn"
            [class.disabled]="!isFormValid() || enviando">
            <mat-icon>send</mat-icon>
            <span>{{ enviando ? 'Enviando...' : 'Enviar Ticket' }}</span>
          </button>
        </div>

      </form>
    </div>

  </div>
</div>