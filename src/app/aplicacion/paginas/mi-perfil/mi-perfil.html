<div class="profile-container">
  <div class="profile-content">
    <!-- Header -->
    <div class="profile-header">
      <div class="header-content">
        <div class="title-section">
          <button (click)="volver()" class="back-button">
            <mat-icon>arrow_back</mat-icon>
          </button>
          <h1>Mi Perfil</h1>
          <span class="role-badge">{{ usuario.rol }}</span>
        </div>
        <p class="header-subtitle">Gestión de información personal</p>
      </div>
    </div>

    <!-- Contenido Principal -->
    <div class="main-content">
      <!-- Formulario de Perfil -->
      <div class="card">
        <form [formGroup]="perfilForm" (ngSubmit)="guardarPerfil()">
          <div class="card-header">
            <mat-icon>person_outline</mat-icon>
            <h3>Información Personal</h3>
          </div>
          
          <div class="card-body">
            <div class="form-section">
              <!-- Nombre -->
              <div class="form-field">
                <label>Nombre completo *</label>
                <mat-form-field appearance="outline">
                  <mat-icon matPrefix>person</mat-icon>
                  <input matInput formControlName="nombre_usuario"
                         [readonly]="!isEditing" placeholder="Nombre completo">
                </mat-form-field>
              </div>

              <!-- Email -->
              <div class="form-field">
                <label>Correo electrónico</label>
                <mat-form-field appearance="outline" class="readonly-field">
                  <mat-icon matPrefix>email</mat-icon>
                  <input matInput formControlName="correo_electronico"
                         type="email" readonly placeholder="correo@ejemplo.com">
                </mat-form-field>
                <span class="field-note">No modificable</span>
              </div>

              <!-- Teléfono -->
              <div class="form-field">
                <label>Teléfono</label>
                <mat-form-field appearance="outline">
                  <mat-icon matPrefix>phone</mat-icon>
                  <input matInput formControlName="telefono"
                         [readonly]="!isEditing" placeholder="Teléfono">
                </mat-form-field>
              </div>
            </div>

            <!-- Cambio de Contraseña (solo en edición) -->
            <div *ngIf="isEditing" class="password-section">
              <div class="section-title">
                <mat-icon>lock_outline</mat-icon>
                <h4>Cambiar Contraseña</h4>
              </div>
              <p class="section-hint">Dejar en blanco si no deseas cambiar</p>
              
              <div class="form-section">
                <div class="form-field">
                  <label>Nueva contraseña</label>
                  <mat-form-field appearance="outline">
                    <mat-icon matPrefix>vpn_key</mat-icon>
                    <input matInput formControlName="newPassword"
                           [type]="hideNewPassword ? 'password' : 'text'"
                           placeholder="Mínimo 6 caracteres">
                    <button mat-icon-button matSuffix type="button"
                            (click)="togglePasswordVisibility('newPassword')">
                      <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>
                  </mat-form-field>
                </div>

                <div class="form-field">
                  <label>Confirmar contraseña</label>
                  <mat-form-field appearance="outline">
                    <mat-icon matPrefix>vpn_key</mat-icon>
                    <input matInput formControlName="confirmPassword"
                           [type]="hideConfirmPassword ? 'password' : 'text'"
                           placeholder="Confirmar contraseña">
                    <button mat-icon-button matSuffix type="button"
                            (click)="togglePasswordVisibility('confirmPassword')">
                      <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>
                  </mat-form-field>
                </div>
              </div>
            </div>

            <!-- Botones de Acción -->
            <div class="action-buttons">
              <button *ngIf="!isEditing" type="button"
                      (click)="toggleEdit()" class="btn-edit">
                <mat-icon>edit</mat-icon>
                Editar Perfil
              </button>
              
              <div *ngIf="isEditing" class="edit-buttons">
                <button type="button" (click)="toggleEdit()" class="btn-cancel">
                  Cancelar
                </button>
                <button type="submit" [disabled]="isLoading || !perfilForm.valid"
                        class="btn-save">
                  <mat-icon *ngIf="!isLoading">save</mat-icon>
                  <mat-icon *ngIf="isLoading" class="spinner">refresh</mat-icon>
                  {{ isLoading ? 'Guardando...' : 'Guardar Cambios' }}
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Información de Cuenta -->
      <div class="card">
        <div class="card-header">
          <mat-icon>info_outline</mat-icon>
          <h3>Información de la Cuenta</h3>
        </div>
        
        <div class="card-body">
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Fecha de registro</span>
              <span class="info-value">{{ usuario.fecha_registro | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Última modificación</span>
              <span class="info-value">{{ usuario.fecha_modificacion | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Estado</span>
              <span [class]="usuario.activo ? 'status-active' : 'status-inactive'">
                {{ usuario.activo ? 'Activo' : 'Inactivo' }}
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Último cambio de contraseña</span>
              <span class="info-value">{{ usuario.fecha_ultimo_cambio_password | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>