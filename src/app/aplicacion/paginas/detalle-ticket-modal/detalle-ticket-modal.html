<div class="modal-container bg-white rounded-xl overflow-hidden w-full h-full flex flex-col shadow-2xl">
  
  <!-- HEADER -->
  <div class="bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 text-white px-6 py-5 flex-shrink-0 shadow-lg">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
      <div class="flex-1">
        <div class="flex items-center gap-3 mb-2">
          <mat-icon class="text-2xl text-blue-200">description</mat-icon>
          <h2 class="text-2xl font-bold text-white">
            Ticket #{{getTicket()?.id || 'Cargando...'}}
          </h2>
          <span [class]="'px-3 py-1.5 rounded-full text-xs font-semibold shadow-sm ' + 
            (isTicketResuelto() ? 'bg-green-100 text-green-800 border border-green-200' :
             hasTecnico() ? 'bg-blue-100 text-blue-800 border border-blue-200' : 'bg-yellow-100 text-yellow-800 border border-yellow-200')">
            {{isTicketResuelto() ? 'âœ… Resuelto' : hasTecnico() ? 'ðŸ”„ En proceso' : 'ðŸ†• Nuevo'}}
          </span>
        </div>
        <p class="text-blue-100 text-lg font-medium truncate">{{getTitulo()}}</p>
      </div>
      
      <div class="flex items-center gap-3">
        <!-- BOTÃ“N PDF -->
        <button 
          mat-raised-button 
          (click)="verPdf()"
          [disabled]="generandoPdf"
          class="bg-white text-blue-600 hover:bg-blue-50 flex items-center gap-2 px-4 py-2 rounded-lg shadow-md transition-all duration-200 hover:shadow-lg">
          <mat-icon *ngIf="!generandoPdf" class="text-lg">picture_as_pdf</mat-icon>
          <mat-progress-spinner *ngIf="generandoPdf" diameter="20" mode="indeterminate"></mat-progress-spinner>
          {{generandoPdf ? 'Generando...' : 'Ver PDF'}}
        </button>

        <!-- BOTÃ“N LOGS -->
        <button 
          mat-raised-button 
          (click)="abrirLogs()"
          class="bg-white text-purple-600 hover:bg-purple-50 flex items-center gap-2 px-4 py-2 rounded-lg shadow-md transition-all duration-200 hover:shadow-lg">
          <mat-icon class="text-lg">history</mat-icon>
          Ver Logs
        </button>
        
        <!-- BOTÃ“N REACTIVAR/CERRAR -->
        <button *ngIf="isTicketResuelto()" 
                mat-raised-button 
                (click)="reactivarTicket()"
                class="bg-orange-500 text-white hover:bg-orange-600 flex items-center gap-2 px-4 py-2 rounded-lg shadow-md transition-all duration-200 hover:shadow-lg">
          <mat-icon class="text-lg">refresh</mat-icon>
          Reactivar
        </button>
        
        <!-- BOTÃ“N CERRAR TICKET - AHORA DISPONIBLE PARA CLIENTES Y TÃ‰CNICOS -->
      <!-- BOTÃ“N VISIBLE PARA TODOS LOS ROLES -->
<button *ngIf="getTicket() && !isTicketResuelto()" 
        mat-raised-button 
        (click)="cerrarTicket()"
        class="bg-green-500 text-white hover:bg-green-600 flex items-center gap-2 px-4 py-2 rounded-lg shadow-md transition-all duration-200 hover:shadow-lg">
  <mat-icon class="text-lg">check_circle</mat-icon>
  Cerrar Ticket
</button>
        <!-- BOTÃ“N ACTUALIZAR MANUAL -->
        <button 
          mat-raised-button 
          (click)="recargarTodo()"
          class="bg-white text-blue-600 hover:bg-blue-50 flex items-center gap-2 px-4 py-2 rounded-lg shadow-md transition-all duration-200 hover:shadow-lg">
          <mat-icon class="text-lg">refresh</mat-icon>
          Actualizar
        </button>
        
        <!-- BOTÃ“N CERRAR MODAL -->
        <button mat-icon-button (click)="cerrar()" class="text-white hover:text-blue-200 transition-colors">
          <mat-icon class="text-xl">close</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- CONTENIDO PRINCIPAL CON SCROLL -->
  <div class="flex-1 overflow-y-auto bg-gray-50">
    
    <!-- LOADING -->
    <div *ngIf="cargando" class="p-8 text-center">
      <div class="flex flex-col items-center justify-center space-y-4">
        <mat-progress-spinner diameter="50" color="primary" mode="indeterminate"></mat-progress-spinner>
        <p class="text-gray-600 font-medium">Cargando informaciÃ³n del ticket...</p>
      </div>
    </div>

    <!-- CONTENIDO PRINCIPAL -->
    <div *ngIf="!cargando" class="flex flex-col lg:flex-row p-6 gap-6 h-full">
      
      <!-- COLUMNA IZQUIERDA - INFORMACIÃ“N PRINCIPAL -->
      <div class="lg:w-2/3 space-y-6">
        
        <!-- DESCRIPCIÃ“N DEL TICKET -->
        <mat-card class="bg-white shadow-xl border-l-4 border-blue-500 rounded-xl">
          <mat-card-header class="bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-200 rounded-t-xl">
            <mat-card-title class="flex items-center gap-3 text-gray-800 py-2">
              <mat-icon class="text-blue-600 text-xl">info</mat-icon>
              <span class="text-xl font-bold">DescripciÃ³n del Ticket</span>
            </mat-card-title>
          </mat-card-header>
          <mat-card-content class="p-6 bg-white rounded-b-xl">
            <div class="prose max-w-none">
              <p class="text-gray-700 text-lg leading-relaxed bg-blue-50 p-4 rounded-lg border border-blue-100">
                {{getDescripcion()}}
              </p>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- ARCHIVOS ADJUNTOS -->
        <mat-expansion-panel [(expanded)]="archivosAbierto" class="shadow-xl rounded-xl overflow-hidden">
          <mat-expansion-panel-header class="bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-200">
            <mat-panel-title class="flex items-center gap-3 text-gray-800 py-3">
              <mat-icon class="text-blue-600 text-xl">attach_file</mat-icon>
              <span class="text-lg font-bold">Archivos Adjuntos</span>
              <span class="bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-bold ml-2">
                {{getArchivos().length}}
              </span>
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="p-6 bg-white">
            <div *ngIf="getArchivos().length === 0" class="text-center py-12 text-gray-500 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300">
              <mat-icon class="text-5xl mb-4 text-gray-400">folder_open</mat-icon>
              <p class="text-lg font-medium text-gray-600">No hay archivos adjuntos</p>
              <p class="text-sm text-gray-500 mt-2">Los archivos aparecerÃ¡n aquÃ­ cuando se adjunten al ticket</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div *ngFor="let archivo of getArchivos()" 
                   class="flex items-center justify-between p-4 border-2 border-gray-200 rounded-xl hover:border-blue-300 hover:bg-blue-50 transition-all duration-200 shadow-sm hover:shadow-md">
                
                <div class="flex items-center gap-4 flex-1 min-w-0">
                  <!-- MINIATURA PARA IMÃGENES -->
                  <div *ngIf="isImageType(archivo.tipo)" 
                       class="w-16 h-16 bg-gray-100 rounded-xl overflow-hidden flex items-center justify-center cursor-pointer border-2 border-gray-300 hover:border-blue-400 transition-all duration-200"
                       (click)="verArchivo(archivo)">
                    <img 
                      [src]="getImageUrlForArchivo(archivo)" 
                      [alt]="archivo.nombre"
                      class="w-full h-full object-cover hover:scale-110 transition-transform duration-300"
                      (error)="handleImageError($event)"
                      loading="lazy"
                    >
                  </div>
                  
                  <!-- ICONO PARA OTROS ARCHIVOS -->
                  <div *ngIf="!isImageType(archivo.tipo)" 
                       class="w-16 h-16 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl flex items-center justify-center border-2 border-blue-200">
                    <mat-icon class="text-blue-600 text-2xl">{{getFileIcon(archivo.tipo)}}</mat-icon>
                  </div>
                  
                  <div class="flex-1 min-w-0">
                    <p class="font-semibold text-gray-900 truncate text-sm" [matTooltip]="archivo.nombre || archivo.nombre">
                      {{archivo.nombre || archivo.nombre}}
                    </p>
                    <p class="text-sm text-gray-600">{{formatFileSize(archivo.tamanio)}}</p>
                    <p class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full inline-block mt-1">
                      {{getTipoArchivoLegible(archivo.tipo)}}
                    </p>
                  </div>
                </div>
                
                <div class="flex gap-2 flex-shrink-0 ml-3">
                  <!-- BotÃ³n VER/ABRIR - SIEMPRE VISIBLE PARA ARCHIVOS VISUALIZABLES -->
                  <button *ngIf="puedeMostrarVistaPrevia(archivo.tipo)" 
                          mat-icon-button 
                          (click)="verArchivo(archivo)" 
                          [matTooltip]="isImageType(archivo.tipo) ? 'Ver imagen ampliada' : 'Abrir en nueva pestaÃ±a'"
                          class="bg-green-100 text-green-600 hover:bg-green-200 transition-colors rounded-lg">
                    <mat-icon class="text-lg">
                      {{isImageType(archivo.tipo) ? 'zoom_in' : 'open_in_new'}}
                    </mat-icon>
                  </button>
                  
                  <!-- NUEVO BOTÃ“N ANIMADO DE DESCARGA -->
                  <div class="download-toggle-container download-toggle-small">
                    <label class="download-toggle-label" 
                            [id]="'download-toggle-' + (archivo.nombre || archivo.nombre_archivo)"
                            (click)="iniciarDescarga(archivo, 'adjunto', $event)">
                      <input type="checkbox" class="download-toggle-input" />
                      <span class="download-toggle-circle">
                        <svg class="download-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 19V5m0 14-4-4m4 4 4-4"/>
                        </svg>
                        <div class="download-square"></div>
                      </span>
                      <p class="download-toggle-title download-title-first">Download</p>
                      <p class="download-toggle-title download-title-last">Open</p>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-expansion-panel>

        <!-- CHAT/CONVERSACIÃ“N MEJORADO -->
        <mat-expansion-panel [(expanded)]="chatAbierto" class="shadow-xl rounded-xl overflow-hidden">
          <mat-expansion-panel-header class="bg-gradient-to-r from-gray-50 to-green-50 border-b border-gray-200">
            <mat-panel-title class="flex items-center gap-3 text-gray-800 py-3">
              <mat-icon class="text-green-600 text-xl">chat</mat-icon>
              <span class="text-lg font-bold">ConversaciÃ³n</span>
              <span class="bg-green-500 text-white px-2 py-1 rounded-full text-xs font-bold ml-2">
                {{getMensajes().length}}
              </span>
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="p-6 bg-white">
            <!-- HISTORIAL DE MENSAJES MEJORADO -->
            <div class="space-y-4 mb-6 max-h-96 overflow-y-auto p-4 bg-gray-50 rounded-xl border border-gray-200" #chatContainer>
              <div *ngFor="let mensaje of getMensajes()" 
                   [class]="'flex ' + (esUsuarioActual(mensaje.usuario_id) ? 'justify-end' : 'justify-start')">
                
                <div [class]="'max-w-[85%] p-4 rounded-2xl shadow-sm ' + 
                  (esUsuarioActual(mensaje.usuario_id) ? 
                   'bg-gradient-to-r from-blue-500 to-blue-600 text-white' : 
                   'bg-white border border-gray-200 shadow-sm')">
                  
                  <!-- Cabecera del mensaje -->
                  <div class="flex items-center gap-2 mb-2">
                    <div [class]="'w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold ' +
                      (esUsuarioActual(mensaje.usuario_id) ? 
                       'bg-blue-400 text-white' : 
                       'bg-gray-300 text-gray-700')">
                      {{getUserInitial(mensaje.usuario)}}
                    </div>
                    <span class="text-sm font-medium">{{getUserName(mensaje.usuario)}}</span>
                    <span [class]="'text-xs ' + (esUsuarioActual(mensaje.usuario_id) ? 'text-blue-100' : 'text-gray-500')">
                      {{mensaje.created_at | date:'HH:mm'}}
                    </span>
                  </div>
                  
                  <!-- Contenido del mensaje -->
                  <div *ngIf="mensaje.tipo_mensaje === 'TEXTO'">
                    <p class="whitespace-pre-wrap">{{mensaje.mensaje}}</p>
                  </div>
                  
                  <div *ngIf="mensaje.tipo_mensaje === 'ARCHIVO'" class="space-y-2">
                    
                    <!-- SI ES IMAGEN - CORREGIDO -->
                    <div *ngIf="isImageType(mensaje.tipo_archivo)" class="space-y-2">
                      <div class="rounded-xl overflow-hidden border-2 border-white shadow-md cursor-pointer" 
                           (click)="verArchivoChat(mensaje)">
                        <img 
                          [src]="getImageUrl(mensaje)" 
                          [alt]="mensaje.nombre_archivo"
                          class="max-w-full max-h-48 rounded-lg hover:opacity-90 transition-all duration-200"
                          (error)="handleImageError($event)"
                          loading="lazy"
                        />
                      </div>
                      <div class="flex items-center justify-between">
                        <div class="flex-1">
                          <p class="font-medium text-sm truncate">{{mensaje.nombre_archivo}}</p>
                          <p class="text-xs opacity-70">{{formatFileSize(mensaje.tamanio_archivo || 0)}}</p>
                        </div>
                        <!-- NUEVO BOTÃ“N ANIMADO DE DESCARGA PARA CHAT -->
                        <div class="download-toggle-container download-toggle-small">
                          <label class="download-toggle-label" 
                                  [id]="'download-toggle-chat-' + mensaje.nombre_archivo"
                                  (click)="iniciarDescarga(mensaje, 'chat', $event)">
                            <input type="checkbox" class="download-toggle-input" />
                            <span class="download-toggle-circle">
                              <svg class="download-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 19V5m0 14-4-4m4 4 4-4"/>
                              </svg>
                              <div class="download-square"></div>
                            </span>
                            <p class="download-toggle-title download-title-first">Download</p>
                            <p class="download-toggle-title download-title-last">Open</p>
                          </label>
                        </div>
                      </div>
                    </div>
                    
                    <!-- SI NO ES IMAGEN - CORREGIDO -->
                    <div *ngIf="!isImageType(mensaje.tipo_archivo)" 
                         [class]="'flex items-center gap-3 p-3 rounded-xl ' +
                         (esUsuarioActual(mensaje.usuario_id) ? 
                          'bg-blue-400 bg-opacity-20' : 
                          'bg-gray-100')">
                      <mat-icon [class]="esUsuarioActual(mensaje.usuario_id) ? 'text-blue-600' : 'text-gray-600'">
                        {{getFileIcon(mensaje.tipo_archivo)}}
                      </mat-icon>
                      <div class="flex-1">
                        <p class="font-medium text-sm">{{mensaje.nombre_archivo}}</p>
                        <p class="text-xs text-gray-600">{{formatFileSize(mensaje.tamanio_archivo || 0)}}</p>
                        <p class="text-xs text-gray-500">{{getTipoArchivoLegible(mensaje.tipo_archivo)}}</p>
                      </div>
                      <div class="flex gap-1">
                        <!-- NUEVO BOTÃ“N ANIMADO DE DESCARGA PARA CHAT -->
                        <div class="download-toggle-container download-toggle-small">
                          <label class="download-toggle-label" 
                                  [id]="'download-toggle-chat-' + mensaje.nombre_archivo"
                                  (click)="iniciarDescarga(mensaje, 'chat', $event)">
                            <input type="checkbox" class="download-toggle-input" />
                            <span class="download-toggle-circle">
                              <svg class="download-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 19V5m0 14-4-4m4 4 4-4"/>
                              </svg>
                              <div class="download-square"></div>
                            </span>
                            <p class="download-toggle-title download-title-first">Download</p>
                            <p class="download-toggle-title download-title-last">Open</p>
                          </label>
                        </div>
                        
                        <!-- BOTÃ“N VER/ABRIR - SOLO PARA ARCHIVOS VISUALIZABLES -->
                        <button *ngIf="puedeMostrarVistaPrevia(mensaje.tipo_archivo)" 
                                mat-icon-button 
                                (click)="verArchivoChat(mensaje)" 
                                [class]="esUsuarioActual(mensaje.usuario_id) ? 
                                         'bg-green-500 text-white hover:bg-green-600' : 
                                         'bg-green-100 text-green-600 hover:bg-green-200'"
                                [matTooltip]="isImageType(mensaje.tipo_archivo) ? 'Ver imagen ampliada' : 'Abrir en nueva pestaÃ±a'"
                                class="rounded-lg transition-colors shadow-sm">
                          <mat-icon class="text-lg">
                            {{isImageType(mensaje.tipo_archivo) ? 'zoom_in' : 'open_in_new'}}
                          </mat-icon>
                        </button>
                      </div>
                    </div>
                    
                    <!-- Mensaje adicional si existe -->
                    <p *ngIf="mensaje.mensaje && mensaje.mensaje !== 'Archivo: ' + mensaje.nombre_archivo" 
                       class="text-sm mt-2">{{mensaje.mensaje}}</p>
                  </div>
                </div>
              </div>
              
              <!-- Sin mensajes -->
              <div *ngIf="getMensajes().length === 0" class="text-center py-12 text-gray-500 bg-white rounded-xl border-2 border-dashed border-gray-300">
                <mat-icon class="text-5xl mb-4 text-gray-400">forum</mat-icon>
                <p class="text-lg font-medium text-gray-600">No hay mensajes en este ticket</p>
                <p class="text-sm text-gray-500 mt-2">SÃ© el primero en enviar un mensaje</p>
              </div>
            </div>

            <!-- INPUT PARA ENVIAR MENSAJES MEJORADO -->
            <div *ngIf="puedeEnviarMensajes()" class="border-t border-gray-200 pt-6">
              <div class="flex gap-3">
                <textarea [(ngModel)]="nuevoMensaje" 
                         placeholder="Escribe tu mensaje aquÃ­..." 
                         class="flex-1 border-2 border-gray-300 rounded-xl p-4 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                         rows="2"
                         (keydown.enter)="$event.preventDefault(); enviarMensaje()"
                         [disabled]="enviandoMensaje || subiendoArchivo">
                </textarea>
                
                <div class="flex flex-col gap-3">
                  <!-- BOTÃ“N ADJUNTAR ARCHIVO -->
                  <input type="file" #fileInput (change)="onArchivoSeleccionado($event)" class="hidden" accept="*/*">
                  <button mat-icon-button (click)="fileInput.click()" 
                         [disabled]="subiendoArchivo"
                         matTooltip="Adjuntar archivo"
                         class="bg-gradient-to-r from-purple-500 to-purple-600 text-white hover:from-purple-600 hover:to-purple-700 transition-all duration-200 rounded-xl w-12 h-12 shadow-md">
                    <mat-icon class="text-xl">attach_file</mat-icon>
                  </button>
                  
                  <!-- BOTÃ“N ENVIAR ANIMADO - NUEVO DISEÃ‘O -->
                  <button 
                    class="send-button"
                    (click)="enviarMensaje()"
                    [disabled]="(!nuevoMensaje.trim() && !archivoChat) || enviandoMensaje || subiendoArchivo"
                    matTooltip="Enviar mensaje">
                    
                    <div class="svg-wrapper-1">
                      <div class="svg-wrapper">
                        <!-- Reemplazamos el SVG por un mat-icon para mantener consistencia -->
                        <mat-icon class="send-icon">send</mat-icon>
                      </div>
                    </div>
                    <span class="send-text">Enviar</span>
                    
                    <!-- Spinner para estado de carga -->
                    <mat-progress-spinner 
                      *ngIf="enviandoMensaje" 
                      diameter="20" 
                      mode="indeterminate"
                      class="send-spinner">
                    </mat-progress-spinner>
                  </button>
                </div>
              </div>
              
              <!-- Progreso de subida MEJORADO -->
              <div *ngIf="subiendoArchivo" class="mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-medium text-blue-700">Enviando archivo...</span>
                  <span class="text-sm font-bold text-blue-600">{{progresoSubida}}%</span>
                </div>
                <mat-progress-bar [value]="progresoSubida" color="primary"></mat-progress-bar>
                <p class="text-xs text-blue-600 mt-2 text-center">Por favor espera, no cierres esta ventana</p>
              </div>

              <!-- Archivo seleccionado para enviar - MEJORADO -->
              <div *ngIf="archivoChat && !subiendoArchivo" class="mt-4 p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-xl border-2 border-green-200 shadow-sm">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <mat-icon class="text-green-600 text-xl">attachment</mat-icon>
                    <div>
                      <span class="text-sm font-medium text-gray-900">{{archivoChat.name}}</span>
                      <span class="text-xs text-gray-500 ml-2">({{formatFileSize(archivoChat.size)}})</span>
                      <p class="text-xs text-gray-600 mt-1">{{getTipoArchivoLegible(archivoChat.type)}}</p>
                    </div>
                  </div>
                  <div class="flex gap-2">
                    <button mat-icon-button 
                            (click)="eliminarArchivoSeleccionado()" 
                            class="text-red-500 hover:bg-red-50 rounded-lg"
                            matTooltip="Quitar archivo">
                      <mat-icon class="text-xl">close</mat-icon>
                    </button>
                  </div>
                </div>
                <p class="text-xs text-gray-500 mt-2">El archivo se enviarÃ¡ junto con tu mensaje al hacer clic en "Enviar"</p>
              </div>
            </div>

            <!-- Mensaje si no se puede enviar -->
            <div *ngIf="!puedeEnviarMensajes()" class="text-center py-8 text-gray-500 border-t border-gray-200 mt-6">
              <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6 inline-block">
                <mat-icon class="text-4xl mb-3 text-yellow-500">lock</mat-icon>
                <p class="text-lg font-medium text-yellow-700">No puedes enviar mensajes</p>
                <p class="text-sm text-yellow-600 mt-1">Este ticket estÃ¡ resuelto y no acepta nuevos mensajes</p>
              </div>
            </div>
          </div>
        </mat-expansion-panel>

      </div>

      <!-- COLUMNA DERECHA - INFORMACIÃ“N TÃ‰CNICA -->
      <div class="lg:w-1/3 space-y-6">
        
        <!-- INFORMACIÃ“N DEL TICKET -->
        <mat-card class="bg-white shadow-xl rounded-xl">
          <mat-card-header class="bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-200 rounded-t-xl">
            <mat-card-title class="flex items-center gap-3 text-gray-800 py-2">
              <mat-icon class="text-blue-600 text-xl">summarize</mat-icon>
              <span class="text-xl font-bold">InformaciÃ³n del Ticket</span>
            </mat-card-title>
          </mat-card-header>
          <mat-card-content class="p-6 space-y-4 bg-white rounded-b-xl">
            
            <!-- ESTADO -->
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-gray-700">Estado:</span>
              <span [class]="'px-3 py-1.5 rounded-full text-xs font-semibold shadow-sm ' + 
                (isTicketResuelto() ? 'bg-green-100 text-green-800 border border-green-200' :
                 hasTecnico() ? 'bg-blue-100 text-blue-800 border border-blue-200' : 'bg-yellow-100 text-yellow-800 border border-yellow-200')">
                {{isTicketResuelto() ? 'âœ… Resuelto' : hasTecnico() ? 'ðŸ”„ En proceso' : 'ðŸ†• Nuevo'}}
              </span>
            </div>

            <!-- PRIORIDAD -->
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-gray-700">Prioridad:</span>
              <span class="text-sm text-gray-900 font-medium">{{getPriorityName(getTicket()?.prioridad)}}</span>
            </div>

            <!-- CATEGORÃA -->
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-gray-700">CategorÃ­a:</span>
              <span class="text-sm text-gray-900 font-medium">{{getCategoryName(getTicket()?.categoria)}}</span>
            </div>

            <!-- TÃ‰CNICO ASIGNADO -->
            <div class="flex justify-between items-start py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-gray-700">TÃ©cnico:</span>
              <div *ngIf="hasTecnico()" class="text-right">
                <p class="text-sm font-medium text-gray-900">{{getUserName(getTecnico())}}</p>
                <p class="text-xs text-gray-500">{{getUserEmail(getTecnico())}}</p>
              </div>
              <span *ngIf="!hasTecnico()" class="text-sm text-gray-400 italic">Sin asignar</span>
            </div>

            <!-- FECHA CREACIÃ“N -->
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-gray-700">Fecha creaciÃ³n:</span>
              <span class="text-sm text-gray-900 font-medium">{{getFechaCreacion()}}</span>
            </div>

            <!-- FECHA RESOLUCIÃ“N -->
            <div *ngIf="isTicketResuelto()" class="flex justify-between items-center py-2">
              <span class="text-sm font-medium text-gray-700">Fecha resoluciÃ³n:</span>
              <span class="text-sm text-green-600 font-medium">{{getFechaResolucion()}}</span>
            </div>

          </mat-card-content>
        </mat-card>

        <!-- RESUMEN RÃPIDO -->
        <mat-card class="bg-white shadow-xl rounded-xl">
          <mat-card-header class="bg-gradient-to-r from-gray-50 to-green-50 border-b border-gray-200 rounded-t-xl">
            <mat-card-title class="flex items-center gap-3 text-gray-800 py-2">
              <mat-icon class="text-green-600 text-xl">analytics</mat-icon>
              <span class="text-xl font-bold">Resumen RÃ¡pido</span>
            </mat-card-title>
          </mat-card-header>
          <mat-card-content class="p-6 space-y-4 bg-white rounded-b-xl">
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-sm text-gray-600 flex items-center gap-2">
                <mat-icon class="text-blue-500 text-lg">chat_bubble</mat-icon>
                Mensajes:
              </span>
              <span class="text-sm font-bold text-gray-900 bg-blue-100 px-3 py-1 rounded-full">
                {{getMensajes().length}}
              </span>
            </div>
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-sm text-gray-600 flex items-center gap-2">
                <mat-icon class="text-green-500 text-lg">attach_file</mat-icon>
                Archivos:
              </span>
              <span class="text-sm font-bold text-gray-900 bg-green-100 px-3 py-1 rounded-full">
                {{getArchivos().length}}
              </span>
            </div>
            <div class="flex justify-between items-center py-2">
              <span class="text-sm text-gray-600 flex items-center gap-2">
                <mat-icon class="text-purple-500 text-lg">history</mat-icon>
                Logs:
              </span>
              <span class="text-sm font-bold text-gray-900 bg-purple-100 px-3 py-1 rounded-full">
                {{getTotalLogs()}}
              </span>
            </div>
          </mat-card-content>
        </mat-card>

      </div>

    </div>
  </div>
</div>

<!-- ESTILOS PARA EL BOTÃ“N ANIMADO DE DESCARGA -->
<style>
/* From Uiverse.io by Na3ar-17 - ADAPTADO */
.download-toggle-container {
  padding: 0;
  margin: 0;
  box-sizing: border-box;
  font-family: Arial, Helvetica, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
}

.download-toggle-label {
  background-color: transparent;
  border: 2px solid rgb(91, 91, 240);
  display: flex;
  align-items: center;
  border-radius: 50px;
  width: 160px;
  cursor: pointer;
  transition: all 0.4s ease;
  padding: 5px;
  position: relative;
  height: 57px;
}

.download-toggle-label::before {
  content: "";
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: #fff;
  width: 8px;
  height: 8px;
  transition: all 0.4s ease;
  border-radius: 100%;
  margin: auto;
  opacity: 0;
  visibility: hidden;
}

.download-toggle-input {
  display: none;
}

.download-toggle-title {
  font-size: 14px;
  color: rgb(91, 91, 240);
  transition: all 0.4s ease;
  position: absolute;
  right: 18px;
  bottom: 19px;
  text-align: center;
  font-weight: 500;
  margin: 0;
}

.download-toggle-title:last-child {
  opacity: 0;
  visibility: hidden;
  color: rgb(35, 174, 35);
}

.download-toggle-circle {
  height: 45px;
  width: 45px;
  border-radius: 50%;
  background-color: rgb(91, 91, 240);
  display: flex;
  justify-content: center;
  align-items: center;
  transition: all 0.4s ease;
  position: relative;
  box-shadow: 0 0 0 0 rgb(255, 255, 255);
  overflow: hidden;
}

.download-toggle-circle .download-icon {
  color: #fff;
  width: 24px;
  height: 24px;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  transition: all 0.4s ease;
}

.download-toggle-circle .download-square {
  aspect-ratio: 1;
  width: 15px;
  border-radius: 2px;
  background-color: #fff;
  opacity: 0;
  visibility: hidden;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  transition: all 0.4s ease;
}

.download-toggle-circle::before {
  content: "";
  position: absolute;
  left: 0;
  top: 0;
  background-color: #3333a8;
  width: 100%;
  height: 0;
  transition: all 0.4s ease;
}

.download-toggle-label.checked {
  width: 57px;
  animation: installed 0.4s ease 3.5s forwards;
}

.download-toggle-label.checked::before {
  animation: rotate 3s ease-in-out 0.4s forwards;
}

.download-toggle-label.checked .download-toggle-circle {
  animation: pulse 1s forwards, circleDelete 0.2s ease 3.5s forwards;
  rotate: 180deg;
}

.download-toggle-label.checked .download-toggle-circle::before {
  animation: installing 3s ease-in-out forwards;
}

.download-toggle-label.checked .download-toggle-circle .download-icon {
  opacity: 0;
  visibility: hidden;
}

.download-toggle-label.checked .download-toggle-circle .download-square {
  opacity: 1;
  visibility: visible;
}

.download-toggle-label.checked .download-title-first {
  opacity: 0;
  visibility: hidden;
}

.download-toggle-label.checked .download-title-last {
  animation: showInstalledMessage 0.4s ease 3.5s forwards;
}

.download-toggle-small {
  transform: scale(0.7);
  transform-origin: center;
}

@keyframes pulse {
  0% {
    scale: 0.95;
    box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
  }
  70% {
    scale: 1;
    box-shadow: 0 0 0 16px rgba(255, 255, 255, 0);
  }
  100% {
    scale: 0.95;
    box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
  }
}

@keyframes installing {
  from {
    height: 0;
  }
  to {
    height: 100%;
  }
}

@keyframes rotate {
  0% {
    transform: rotate(-90deg) translate(27px) rotate(0);
    opacity: 1;
    visibility: visible;
  }
  99% {
    transform: rotate(270deg) translate(27px) rotate(270deg);
    opacity: 1;
    visibility: visible;
  }
  100% {
    opacity: 0;
    visibility: hidden;
  }
}

@keyframes installed {
  100% {
    width: 150px;
    border-color: rgb(35, 174, 35);
  }
}

@keyframes circleDelete {
  100% {
    opacity: 0;
    visibility: hidden;
  }
}

@keyframes showInstalledMessage {
  100% {
    opacity: 1;
    visibility: visible;
    right: 56px;
  }
}

/* ESTILOS PARA EL BOTÃ“N DE ENVIAR */
.send-button {
  font-family: inherit;
  font-size: 16px;
  background: royalblue;
  color: white;
  padding: 0.7em 1em;
  padding-left: 0.9em;
  display: flex;
  align-items: center;
  border: none;
  border-radius: 16px;
  overflow: hidden;
  transition: all 0.2s;
  cursor: pointer;
  height: 48px;
  width: 120px;
  justify-content: center;
  position: relative;
}

.send-button:disabled {
  background: #9ca3af;
  cursor: not-allowed;
  transform: none !important;
}

.send-button:disabled:hover {
  background: #9ca3af;
}

.send-button:disabled .svg-wrapper {
  animation: none !important;
}

.send-button:disabled .send-icon {
  transform: none !important;
}

.send-button:disabled .send-text {
  transform: none !important;
}

.send-text {
  display: block;
  margin-left: 0.3em;
  transition: all 0.3s ease-in-out;
  font-weight: 500;
}

.send-icon {
  display: block;
  transform-origin: center center;
  transition: transform 0.3s ease-in-out;
  font-size: 20px;
  width: 20px;
  height: 20px;
}

.send-button:hover:not(:disabled) .svg-wrapper {
  animation: fly-1 0.6s ease-in-out infinite alternate;
}

.send-button:hover:not(:disabled) .send-icon {
  transform: translateX(1.2em) rotate(45deg) scale(1.1);
}

.send-button:hover:not(:disabled) .send-text {
  transform: translateX(5em);
}

.send-button:active:not(:disabled) {
  transform: scale(0.95);
}

.send-spinner {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
}

@keyframes fly-1 {
  from {
    transform: translateY(0.1em);
  }
  to {
    transform: translateY(-0.1em);
  }
}
</style>