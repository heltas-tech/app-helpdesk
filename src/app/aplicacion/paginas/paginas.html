<div class="flex h-screen">
    <!-- Sidebar -->
    <div *ngIf="isSidebarOpen"
        class="bg-zinc-100 text-gray-900 w-64 p-4 space-y-2 absolute z-50 md:static md:block min-h-screen">
        <div class="flex items-center justify-between mb-6">
            <a [routerLink]="'inicio'"><img src="assets/images/ceass.png" alt="Logo"
                    class="h-10 object-contain"></a>
            <button class="md:hidden" (click)="isSidebarOpen = false">
                <mat-icon>close</mat-icon>
            </button>
        </div>

        <div *ngFor="let item of menu"> 
            <button (click)="toggleSubmenu(item)"
                class="w-full flex items-center justify-between px-2 py-2 hover:bg-zinc-300 rounded">
                <div class="flex items-center space-x-2">
                    <mat-icon>{{ item.icono }}</mat-icon>
                    {{ item.menu }}
                </div>
                <mat-icon *ngIf="item.hijos">{{ item.expanded ? 'expand_less' : 'expand_more' }}</mat-icon>
            </button>

            <div *ngIf="item.hijos && item.expanded" class="ml-8 space-y-1">
                <button *ngFor="let child of item.hijos"
                    class="flex items-reigth w-full px-2 py-1 hover:bg-zinc-300 rounded text-sm"
                    (click)="onSubmenuClick()">
                    <a [routerLink]="[child.url]" routerLinkActive="bg-black-200 font-semibold text-black-800 rounded"
                        class="flex items-center w-full px-2 py-1 hover:bg-zinc-300 rounded text-sm text-left space-x-2">
                        <mat-icon class="text-sm mr-2">chevron_right</mat-icon>
                        {{ child.menu }}
                    </a>
                </button>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="flex-1 flex flex-col">
        <nav class="bg-zinc-100 text-gray-800 p-4 flex items-center justify-between shadow-md">
            <!-- Botón Hamburguesa -->
            <div class="flex items-center space-x-2">
                <button class="md:hidden" (click)="isSidebarOpen = true">
                    <mat-icon>menu</mat-icon>
                </button>
                <button class="hidden md:block" (click)="toggleSidebarPersistent()" mat-icon-button>
                    <mat-icon>{{isSidebarOpen ? 'chevron_left' : 'menu'}}</mat-icon>
                </button>
            </div>
            
            <div class="text-xl font-bold">{{tituloSistema}}</div>

            <!-- Contenedor de elementos del lado derecho -->
            <div class="flex items-center space-x-4">
                <!-- Notificaciones -->
                <app-notificaciones-campanita></app-notificaciones-campanita>

                <!-- ✅ BOTÓN DEL USUARIO QUE FALTABA -->
                <button 
                    mat-icon-button 
                    [matMenuTriggerFor]="userMenu"
                    class="flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors">
                    <mat-icon class="text-2xl">account_circle</mat-icon>
                    <span class="hidden md:block text-sm font-medium">
                        {{ userRol || 'Usuario' }}
                    </span>
                </button>
            </div>

            <!-- Menú desplegable del usuario -->
            <mat-menu #userMenu="matMenu" class="user-profile-menu">
                <div class="px-4 py-3 border-b border-gray-200 bg-gray-50">
                    <p class="text-sm font-semibold text-gray-800">Sistema de Tickets</p>
                    <p class="text-xs text-gray-600 mt-1">{{ userRol || 'Usuario' }}</p>
                </div>
                
                <a mat-menu-item [routerLink]="'mi-perfil'" class="flex items-center"> 
                    <mat-icon class="mr-3">person</mat-icon>
                    <span>Mi Perfil</span>
                </a>
                
                <button mat-menu-item (click)="logout()" class="flex items-center text-red-600">
                    <mat-icon class="mr-3">logout</mat-icon>
                    <span>Cerrar Sesión</span>
                </button>
            </mat-menu>
        </nav>

        <!-- Área de contenido principal -->
        <div class="flex-1 p-4 overflow-auto">
            <router-outlet></router-outlet>
        </div>
    </div>
</div>