<div class="modal-container">
  <div class="card">
    
    <!-- Título -->
    <a class="login">{{ isEditMode ? 'EDITAR SUBCATEGORÍA' : 'NUEVA SUBCATEGORÍA' }}</a>

    <form [formGroup]="form" class="form-content">
      
      <!-- Campo Nombre -->
      <div class="inputBox">
        <input 
          type="text" 
          formControlName="nombre"
          required
          maxlength="100"
          autocomplete="off"
          [class.has-value]="nombre?.value"
          [class.invalid]="nombre?.invalid && nombre?.touched"
          >
        <span>Nombre</span>
        @if (nombre?.invalid && nombre?.touched) {
          <div class="error-message">
            {{ getErrorMessage('nombre') }}
          </div>
        }
        <div class="char-counter">
          {{ nombre?.value?.length || 0 }}/100
        </div>
      </div>

      <!-- Campo Descripción -->
      <div class="inputBox">
        <input 
          type="text" 
          formControlName="descripcion"
          maxlength="200"
          autocomplete="off"
          [class.has-value]="form.get('descripcion')?.value"
          [class.invalid]="form.get('descripcion')?.invalid && form.get('descripcion')?.touched"
          >
        <span>Descripción</span>
        <div class="char-counter">
          {{ form.get('descripcion')?.value?.length || 0 }}/200
        </div>
      </div>

      <!-- Campo Categoría -->
      <div class="inputBox">
        <select 
          formControlName="categoria_id"
          required
          [class.has-value]="categoria_id?.value"
          [class.invalid]="categoria_id?.invalid && categoria_id?.touched"
          >
          <option value="">Selecciona una categoría</option>
          <option *ngFor="let cat of categorias" [value]="cat.id" [disabled]="!cat.estado && !isEditMode">
            {{ cat.nombre }} {{ !cat.estado ? '(Inactiva)' : '' }}
          </option>
        </select>
        <span>Categoría</span>
        @if (categoria_id?.invalid && categoria_id?.touched) {
          <div class="error-message">
            {{ getErrorMessage('categoria_id') }}
          </div>
        }
      </div>

      <!-- Estado -->
      <div class="toggle-container">
        <label class="toggle-label">Estado:</label>
        <mat-slide-toggle 
          formControlName="estado"
          color="primary"
          class="custom-toggle">
          {{ form.get('estado')?.value ? 'Activa' : 'Inactiva' }}
        </mat-slide-toggle>
      </div>

      <!-- Información de categorías inactivas -->
      <div class="info-box" *ngIf="hasCategoriasInactivas()">
        <div class="info-content">
          <div class="info-icon">!</div>
          <div class="info-text">
            <strong>Categorías Inactivas</strong>
            <p>Las categorías marcadas como "(Inactiva)" no están disponibles para nuevas subcategorías</p>
          </div>
        </div>
      </div>

      <!-- Mensaje de validación general -->
      @if (form.invalid && form.touched) {
        <div class="validation-message">
          <span>Completa todos los campos obligatorios correctamente</span>
        </div>
      }

      <input type="hidden" formControlName="id">

    </form>

    <!-- Botones -->
    <div class="button-container">
      <button 
        (click)="cancel()"
        class="cancel-btn">
        Cancelar
      </button>
      
      <button 
        (click)="save()"
        [disabled]="form.invalid"
        class="enter-btn"
        [class.disabled]="form.invalid">
        {{ isEditMode ? 'ACTUALIZAR' : 'CREAR' }}
      </button>
    </div>

  </div>
</div>