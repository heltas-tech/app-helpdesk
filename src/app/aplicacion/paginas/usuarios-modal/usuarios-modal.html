<div class="modal-container">
  <div class="card">
    
    <!-- Título -->
    <a class="login">{{ isEditMode ? 'EDITAR USUARIO' : 'NUEVO USUARIO' }}</a>

    <form [formGroup]="form" class="form-content">
      
      <!-- Campo Nombre Usuario -->
      <div class="inputBox">
        <input 
          type="text" 
          formControlName="nombre_usuario"
          required
          maxlength="100"
          autocomplete="off"
          [class.has-value]="nombre_usuario?.value"
          [class.invalid]="nombre_usuario?.invalid && nombre_usuario?.touched"
          >
        <span>Nombre Completo</span>
        @if (nombre_usuario?.invalid && nombre_usuario?.touched) {
          <div class="error-message">
            {{ getErrorMessage('nombre_usuario') }}
          </div>
        }
      </div>

      <!-- Campo Correo Electrónico -->
      <div class="inputBox">
        <input 
          type="email" 
          formControlName="correo_electronico"
          required
          autocomplete="off"
          [class.has-value]="correo_electronico?.value"
          [class.invalid]="correo_electronico?.invalid && correo_electronico?.touched"
          >
        <span>Correo Electrónico</span>
        @if (correo_electronico?.invalid && correo_electronico?.touched) {
          <div class="error-message">
            {{ getErrorMessage('correo_electronico') }}
          </div>
        }
      </div>

      <!-- Campos Teléfono y Rol en línea -->
      <div class="row-fields">
        <!-- Teléfono -->
        <div class="inputBox half-width">
          <input 
            type="text" 
            formControlName="telefono"
            maxlength="15"
            autocomplete="off"
            [class.has-value]="telefono?.value"
            [class.invalid]="telefono?.invalid && telefono?.touched"
            >
          <span>Teléfono</span>
          @if (telefono?.invalid && telefono?.touched) {
            <div class="error-message">
              {{ getErrorMessage('telefono') }}
            </div>
          }
        </div>

        <!-- Rol -->
        <div class="inputBox half-width">
          <select 
            formControlName="rol"
            required
            [class.has-value]="rol?.value"
            [class.invalid]="rol?.invalid && rol?.touched"
            >
            <option value="" disabled selected>Seleccione un rol</option>
            <option value="CLIENTE">CLIENTE</option>
            <option value="TECNICO">TÉCNICO</option>
            <option value="ADMINISTRADOR">ADMINISTRADOR</option>
          </select>
          <span>Rol</span>
          @if (rol?.invalid && rol?.touched) {
            <div class="error-message">
              {{ getErrorMessage('rol') }}
            </div>
          }
        </div>
      </div>

      <!-- Estado -->
      <div class="toggle-container">
        <label class="toggle-label">Estado:</label>
        <mat-slide-toggle 
          formControlName="activo"
          color="primary"
          class="custom-toggle">
          {{ form.get('activo')?.value ? 'Activo' : 'Inactivo' }}
        </mat-slide-toggle>
      </div>

      <!-- Información para nuevo usuario CLIENTE -->
      @if (esCliente() && !isEditMode) {
        <div class="info-box">
          <div class="info-content">
            <div class="info-icon">i</div>
            <div class="info-text">
              <strong>Usuario CLIENTE</strong>
              <p>Las credenciales de acceso se enviarán automáticamente al correo electrónico proporcionado. 
                El usuario podrá cambiar su contraseña en el primer acceso.</p>
            </div>
          </div>
        </div>
      }

      <!-- Mensaje de validación general -->
      @if (form.invalid && form.touched) {
        <div class="validation-message">
          <span>Completa todos los campos obligatorios correctamente</span>
        </div>
      }

      <input type="hidden" formControlName="id">

    </form>

    <!-- Botones -->
    <div class="button-container">
      <button 
        (click)="cancel()"
        class="cancel-btn">
        Cancelar
      </button>
      
      <button 
        (click)="save()"
        [disabled]="form.invalid"
        class="enter-btn"
        [class.disabled]="form.invalid">
        {{ isEditMode ? 'ACTUALIZAR' : 'CREAR' }}
      </button>
    </div>

  </div>
</div>