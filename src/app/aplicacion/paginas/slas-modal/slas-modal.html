<div class="modal-container">
  <div class="card">
    
    <!-- Título - SIEMPRE VISIBLE -->
    <a class="login">{{ isEditMode ? 'EDITAR SLA' : 'NUEVO SLA' }}</a>

    <form [formGroup]="form" class="form-content">
      
      <!-- Campo Nombre -->
      <div class="inputBox">
        <input 
          type="text" 
          formControlName="nombre"
          required
          [class.has-value]="nombre?.value"
          [class.invalid]="nombre?.invalid && nombre?.touched">
        <span>Nombre del SLA</span>
        @if (nombre?.invalid && nombre?.touched) {
          <div class="error-message">
            {{ getErrorMessage('nombre') }}
          </div>
        }
      </div>

      <!-- Campo Descripción -->
      <div class="inputBox">
        <textarea 
          formControlName="descripcion"
          [class.has-value]="descripcion?.value"></textarea>
        <span>Descripción</span>
      </div>

      <!-- Campo Tipo SLA -->
      <div class="inputBox">
        <select 
          formControlName="tipo_sla_id"
          required
          [class.has-value]="tipo_sla_id?.value"
          [class.invalid]="tipo_sla_id?.invalid && tipo_sla_id?.touched">
          <option value=""></option>
          <option *ngFor="let tipo of tiposSlaDisponibles" [value]="tipo.id">
            {{ tipo.nombre }}
          </option>
        </select>
        <span>Tipo de SLA</span>
        @if (tipo_sla_id?.invalid && tipo_sla_id?.touched) {
          <div class="error-message">
            {{ getErrorMessage('tipo_sla_id') }}
          </div>
        }
      </div>

      <!-- Sección de Prioridades -->
      <div class="prioridades-section">
        <span class="section-title">Seleccionar Prioridades</span>
        <p class="section-description">
          Seleccione las prioridades que incluirá este SLA. 
          La primera prioridad seleccionada será la principal.
        </p>
        
        <!-- Lista de Prioridades -->
        <div class="prioridades-grid">
          <div 
            *ngFor="let prioridad of prioridadesDisponibles" 
            class="prioridad-item"
            [class.selected]="isPrioridadSeleccionada(prioridad.id)"
            (click)="togglePrioridad(prioridad.id)">
            
            <div class="prioridad-header">
              <span 
                class="prioridad-nombre"
                [style.background]="getPrioridadColor(prioridad.nivel).split(' ')[0]"
                [style.color]="getPrioridadColor(prioridad.nivel).split(' ')[1]"
                [style.border-color]="getPrioridadColor(prioridad.nivel).split(' ')[3]">
                {{ prioridad.nombre }}
              </span>
              <span class="prioridad-nivel">Nivel {{ prioridad.nivel }}</span>
            </div>
            
            <div class="prioridad-desc">
              {{ prioridad.descripcion || 'Sin descripción' }}
            </div>
            
            <div class="prioridad-tiempos">
              <div class="tiempo-item">
                <mat-icon class="tiempo-icon" style="color: #3b82f6;">schedule</mat-icon>
                <span>Resp: {{ formatearTiempo(prioridad.tiempo_respuesta) }}</span>
              </div>
              <div class="tiempo-item">
                <mat-icon class="tiempo-icon" style="color: #10b981;">timer</mat-icon>
                <span>Resol: {{ formatearTiempo(prioridad.tiempo_resolucion) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Mensaje de advertencia si no hay prioridades -->
        @if ((prioridades_ids?.value || []).length === 0) {
          <div class="warning-message">
            <mat-icon class="warning-icon">warning</mat-icon>
            <span class="warning-text">Debe seleccionar al menos una prioridad</span>
          </div>
        }

        <!-- Prioridades seleccionadas -->
        @if ((prioridades_ids?.value || []).length > 0) {
          <div class="prioridades-seleccionadas">
            <div class="seleccionadas-title">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px;">check_circle</mat-icon>
              Prioridades seleccionadas ({{ prioridades_ids?.value.length }})
            </div>
            <div class="prioridades-list">
              <span 
                *ngFor="let prioridadId of prioridades_ids?.value; let i = index" 
                class="prioridad-seleccionada"
                [class.principal]="i === 0"
                [class.secundaria]="i > 0">
                {{ getPrioridadNombre(prioridadId) }}
                @if (i === 0) {
                  <span class="principal-badge">Principal</span>
                }
              </span>
            </div>
          </div>
        }
      </div>

      <!-- Estado -->
      <div class="toggle-container">
        <label class="toggle-label">Estado del SLA:</label>
        <mat-slide-toggle 
          formControlName="estado"
          color="primary"
          class="custom-toggle">
          {{ form.get('estado')?.value ? 'Activo' : 'Inactivo' }}
        </mat-slide-toggle>
      </div>

      <input type="hidden" formControlName="id">

    </form>

    <!-- Botones - SIEMPRE VISIBLES -->
    <div class="button-container">
      <button 
        (click)="cancel()"
        class="cancel-btn">
        Cancelar
      </button>
      
      <button 
        (click)="save()"
        [disabled]="!isFormValid()"
        class="enter-btn"
        [class.disabled]="!isFormValid()">
        {{ isEditMode ? 'ACTUALIZAR' : 'CREAR' }}
      </button>
    </div>

  </div>
</div>